<html>
    <head>
        <style>
            * {
                margin: 0;
                padding: 0;
            }
            body {
                font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            }
            button {
                width: 100%;
                height: 150px;
                font-size: 22px;
            }
            #menu-bar {
                padding: 15px;
                list-style-type: none;
                display: flex;
                justify-content: space-between;
                background: darkgray;
            }
            #game-screen {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
            }
        </style>
    </head>
    <body>
        <div id="screen">
            <ul id="menu-bar">
                <li>Pause</li>
                <li id="player-turn">Player Turn</li>
                <li>Game State: <span id="game-state" style="color: red;">Not Playing</span></li>
            </ul>
            <div id="game-screen">

            </div>
        </div>
        <script>
            function UI() {
                let buttonHandler = function() {}
                this.askForPlayerNames = function() {
                    const playerNames = [];
                    let player1Name = "", player2Name = "";

                    while(!player1Name || !player2Name)
                    {
                        player1Name = prompt("What is your name?");
                        player2Name = prompt("What is the other player name?");
                    }

                    playerNames.push(player1Name);
                    playerNames.push(player2Name);

                    return playerNames;
                }

                this.askForUserSymbols = function() {
                    const playersSymbols = [];

                    let player1Symbol = "", player2Symbol = "";

                    while(!player1Symbol || !player2Symbol) {
                        player1Symbol = prompt("What is the first player symbol?")
                        player2Symbol = prompt("What is the other player symbol?");
                    }

                    playersSymbols.push(player1Symbol);
                    playersSymbols.push(player2Symbol);

                    return playersSymbols;
                }

                this.showMessage = function(msg) {
                    alert(msg);
                }

                this.setButtonHandler = function(func) {
                    buttonHandler = func;
                }

                this.createUI = function() {
                    const buttonsCount = 9;
                    const parent = document.querySelector('#game-screen');

                    for(let i = 0; i < buttonsCount; i++) {
                        let btn = document.createElement('button');
                        btn.innerText = "-";
                        btn.disabled = true;
                        btn.onclick = function(e) {
                            let row = parseInt([...parent.children].indexOf(btn)/3);
                            let col = parseInt([...parent.children].indexOf(btn)%3);
                            buttonHandler(row, col);
                            btn.disabled = true;
                        };
                        parent.appendChild(btn);
                    }
                }

                this.setPlayerTurn = function(playerName) {
                    const playerTurnEl = document.querySelector('#player-turn');
                    playerTurnEl.innerText = playerName;
                }

                this.setGameState = function(str) {
                    const gameStateTitle = document.querySelector('#game-state');

                    gameStateTitle.innerHTML = str;
                    if(str === "End" || str === "Not Playing") {
                        gameStateTitle.style.color = "red";
                    }
                    else {
                        gameStateTitle.style.color = "green";
                    }
                }

                this.displayPlays = function(plays) {
                    let parent = document.querySelector('#game-screen').children;
                    
                    for(let i = 0; i < parent.length; i++) {
                        parent[i].innerText = plays[parseInt(i/3)][parseInt(i%3)];
                    }
                }

                this.start = function(playerTurnSymbol) {
                    const parent = document.querySelector('#game-screen');

                    for(let btn of parent.children) {
                        btn.disabled = false;
                    }
                }

                this.resetUI = function() {
                    const parent = document.querySelector('#game-screen');
                    parent.children = null;
                    this.createUI();
                }
            }
        </script>
        <script>
            function Player(player_name, player_symbol) {
                let name = player_name;
                let symbol = player_symbol;

                this.setPlayerName = function(player_name) {
                    name = player_name;
                }

                this.setPlayerSymbol = function(player_symbol) {
                    symbol = player_symbol;
                }

                this.getPlayerName = function() {
                    return name;
                }

                this.getPlayerSymbol = function() {
                    return symbol;
                }
            }
        </script>
        <script>
            function Game() {
                // private members
                let plays = [
                    ['-', '-', '-'], 
                    ['-', '-', '-'],
                    ['-', '-', '-']
                ]; // matrix
                const players = [];
                let playerTurn = new Player("", "");
                let gameState = "Not Playing";

                const ui = new UI();

                let generateRandNumber = function() {
                    return Math.floor(Math.random()*9);
                }

                let choosePlayerTurn = function() {
                    let randNumber = generateRandNumber();
                    return randNumber >= 5 ? 1 : 0;
                }

                let checkWrapper = function(obj1, obj2, obj3) {
                    if(obj1 === '-' || obj2 === '-' || obj3 == '-')
                        return false;

                    return obj1 === obj2 && obj1 === obj3 && obj2 === obj3;
                }

                let checkWinPossability = function() {
                    const firstRowCheck = checkWrapper(plays[0][0], plays[0][1], plays[0][2]);
                    const secondRowCheck = checkWrapper(plays[1][0], plays[1][1], plays[1][2]);
                    const thirdRowCheck = checkWrapper(plays[2][0], plays[2][1], plays[2][2]);

                    const firstColCheck = checkWrapper(plays[0][0], plays[1][0], plays[2][0]);
                    const secondColCheck = checkWrapper(plays[0][1], plays[1][1], plays[2][1]);
                    const thirdColCheck = plays[0][2] === plays[1][2] === plays[2][2];

                    const rightDiagnolCheck = checkWrapper(plays[0][2], plays[1][1], plays[2][0]);
                    const leftDiagnolCheck = checkWrapper(plays[0][0], plays[1][1], plays[2][2]);

                    if(firstRowCheck || secondRowCheck || thirdRowCheck || firstColCheck || secondColCheck || thirdColCheck || rightDiagnolCheck || leftDiagnolCheck) {
                        return true;
                    }
                    else {
                        return false;
                    }
                }

                let areAllPlaysAreFilled = function() {
                    for (let i = 0; i < 3; i++) {
                        for(let j = 0; j < 3; j++) {
                            if(plays[i][j] == '-') {
                                return false;
                            }
                        }
                    }

                    return true;
                }

                let resetPlay = function() {
                    gameState = "Not Playing";
                    for(let i = 0; i < 3; i++) {
                        for(let j = 0; j < 3; j++) {
                            plays[i][j] = '-';
                        }
                    }
                    playerTurn = new Player();
                    players = [];
                    ui.resetUI();
                }

                let buttonHandler = function(row, col) {
                    plays[row][col] = playerTurn.getPlayerSymbol();
                    ui.displayPlays(plays);

                    if(checkWinPossability()) {
                        ui.showMessage(`${playerTurn.getPlayerName()} Won`);

                        let playAgain = confirm("Do you want to play again?");
                        if(playAgain) {
                            location.reload();
                        }
                    }
                    else {
                        if(areAllPlaysAreFilled()) {
                            ui.showMessage("It's a Tie");

                            let playAgain = confirm("Do you want to play again?");
                            if(playAgain) {
                                location.reload();
                            }
                        }
                        else {
                            playerTurn = players[0] == playerTurn ? players[1] : players[0];
                            ui.setPlayerTurn(playerTurn.getPlayerName() + ": " + playerTurn.getPlayerSymbol());
                        }
                    }
                }

                // public members
                this.start = function() {
                    ui.createUI();
                    let playersNames = ui.askForPlayerNames();
                    let playersSymbols = ui.askForUserSymbols();

                    players.push(new Player(playersNames[0], playersSymbols[0]));
                    players.push(new Player(playersNames[1], playersSymbols[1]));

                    playerTurn = players[choosePlayerTurn()];

                    gameState = "Playing";
                    ui.setGameState(gameState);
                    ui.start();

                    ui.setButtonHandler(buttonHandler);

                    ui.setPlayerTurn(playerTurn.getPlayerName() + ": " + playerTurn.getPlayerSymbol());
                }
            }
        </script>
        <script>
            window.addEventListener('load', function() {
                let game = new Game();
                game.start();
            });
        </script>
    </body>
</html>